<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>地域フォルダ</title>
<style>
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont;
  background:#f2f2f7;
}
.header{
  position:sticky;
  top:0;
  background:white;
  padding:15px;
  font-weight:600;
  border-bottom:1px solid #ddd;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.list{
  background:white;
}
.item{
  padding:16px;
  border-bottom:1px solid #eee;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.item:active{
  background:#e5e5ea;
}
button{
  background:#007aff;
  color:white;
  border:none;
  padding:8px 12px;
  border-radius:8px;
}
button.hidden{
  visibility:hidden;
}
.back{
  color:#007aff;
  background:none;
}
img{
  width:60px;
  height:60px;
  object-fit:cover;
  border-radius:8px;
}
</style>
</head>
<body>

<div class="header">
  <button class="back" onclick="goBack()">←</button>
  <div id="title">日本</div>
  <div>
    <button id="addBtn" onclick="addFolder()">＋</button>
  </div>
</div>

<div class="list" id="list"></div>

<input type="file" id="fileInput" accept="image/*" style="display:none" onchange="addImage(event)">

<script>
let stack=[];
let data=JSON.parse(localStorage.getItem("folderData"))||createInitialData();
let current=data;

function createInitialData(){
  const structure={
    "北海道・東北":[
      "北海道","青森県","岩手県","宮城県","秋田県","山形県","福島県"
    ],
    "関東":[
      "茨城県","栃木県","群馬県","埼玉県","千葉県","東京都","神奈川県"
    ],
    "中部":[
      "新潟県","富山県","石川県","福井県","山梨県","長野県",
      "岐阜県","静岡県","愛知県"
    ],
    "近畿":[
      "三重県","滋賀県","京都府","大阪府","兵庫県","奈良県","和歌山県"
    ],
    "中国・四国":[
      "鳥取県","島根県","岡山県","広島県","山口県",
      "徳島県","香川県","愛媛県","高知県"
    ],
    "九州・沖縄":[
      "福岡県","佐賀県","長崎県","熊本県","大分県",
      "宮崎県","鹿児島県","沖縄県"
    ]
  };

  let root={name:"日本",children:[],images:[],locked:true,allowImage:false};

  for(let region in structure){
    let regionFolder={
      name:region,
      children:[],
      images:[],
      locked:true,
      allowImage:false
    };

    structure[region].forEach(pref=>{
      regionFolder.children.push({
        name:pref,
        children:[],
        images:[],
        locked:false,
        allowImage:false   // ← 都道府県では画像不可
      });
    });

    root.children.push(regionFolder);
  }
  return root;
}

function render(){
  document.getElementById("title").innerText=current.name;

  const addBtn=document.getElementById("addBtn");
  if(current.locked){
    addBtn.classList.add("hidden");
  }else{
    addBtn.classList.remove("hidden");
  }

  let list=document.getElementById("list");
  list.innerHTML="";

  current.children?.forEach(folder=>{
    let div=document.createElement("div");
    div.className="item";
    div.innerHTML=`<span>${folder.name}</span><span>></span>`;
    div.onclick=()=>{
      stack.push(current);
      current=folder;
      render();
    };
    list.appendChild(div);
  });

  current.images?.forEach((img,i)=>{
    let div=document.createElement("div");
    div.className="item";
    div.innerHTML=`<img src="${img}"><span>削除</span>`;
    div.onclick=()=>{
      current.images.splice(i,1);
      save();
      render();
    };
    list.appendChild(div);
  });
}

function addFolder(){
  if(current.locked)return;
  let name=prompt("フォルダ名");
  if(!name)return;

  current.children.push({
    name:name,
    children:[],
    images:[],
    locked:false,
    allowImage:true   // ← 作成したフォルダのみ画像OK
  });

  save();
  render();
}

function addImage(e){
  if(!current.allowImage)return;

  let file=e.target.files[0];
  if(!file)return;

  let reader=new FileReader();
  reader.onload=function(evt){
    current.images.push(evt.target.result);
    save();
    render();
  };
  reader.readAsDataURL(file);
}

document.body.addEventListener("dblclick",()=>{
  if(current.allowImage){
    document.getElementById("fileInput").click();
  }
});

function goBack(){
  if(stack.length>0){
    current=stack.pop();
    render();
  }
}

function save(){
  localStorage.setItem("folderData",JSON.stringify(data));
}

render();
</script>

</body>
</html>